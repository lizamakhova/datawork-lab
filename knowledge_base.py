# Ð‘Ð°Ð·Ð° Ð·Ð½Ð°Ð½Ð¸Ð¹ DataWork Lab
KNOWLEDGE_BASE = {
    "partner_statuses": {
        "title": "ðŸ“‹ Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ Ð² Ñ€ÐµÐµÑÑ‚Ñ€Ð°Ñ… Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð¾Ð²",
        "content": """
        ## ÐŸÐ°Ñ€Ñ‚Ð½ÐµÑ€ Ð
        - **COMPLETED** = ÑƒÑÐ¿ÐµÑˆÐ½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ
        - **DECLINED** = Ð¾Ñ‚ÐºÐ°Ð·Ð°Ð½Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ  
        - **IN_PROGRESS** = Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ

        ## ÐŸÐ°Ñ€Ñ‚Ð½ÐµÑ€ Ð‘
        - **SUCCESS** = ÑƒÑÐ¿ÐµÑˆÐ½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ
        - **FAILED** = Ð¾Ñ‚ÐºÐ°Ð·Ð°Ð½Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ

        ### ðŸ’¡ Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°:
        - Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð° Ð²ÑÐµÐ³Ð´Ð° Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ð½Ñ‹ Ð½Ð°Ð´ Ð½Ð°ÑˆÐ¸Ð¼Ð¸
        - ÐŸÑ€Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸ÑÑ… ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð² Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÐÐÐ¨Ð˜ Ð´Ð°Ð½Ð½Ñ‹Ðµ
        - Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð° ÑÐ²Ð»ÑÑŽÑ‚ÑÑ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð¼ Ð¸ÑÑ‚Ð¸Ð½Ñ‹

        ### ðŸŽ¯ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ€Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ:
        - ÐÐ°Ñˆ ÑÑ‚Ð°Ñ‚ÑƒÑ: `success`
        - Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð°: `DECLINED`
        - ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ: Ð˜ÑÐ¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð°Ñˆ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð½Ð° `failed`
        """
    },
    "revenue_calculation": {
        "title": "ðŸ§® Ð Ð°ÑÑ‡ÐµÑ‚ Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸",
        "content": """
        ## Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð° Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸:
        ```
        Ð’Ñ‹Ñ€ÑƒÑ‡ÐºÐ° = amount - commission_amount
        ```

        ## Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÑÑ‚Ð°Ð²Ð¾Ðº ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ð¹:
        | ÐŸÐ°Ñ€Ñ‚Ð½ÐµÑ€ | ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ | Ð¤Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ | Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð° |
        |---------|---------|---------------|------------------|
        | PARTNER_A | 2% | 0.50 EUR | amount * 0.02 + 0.50 |
        | PARTNER_B | 1.5% | 1.00 EUR | amount * 0.015 + 1.00 |

        ## âš ï¸ ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¿Ñ€Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸ÑÑ…:
        1. **ÐÐ°Ð¹Ñ‚Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ** Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð¾Ð¼ Ð¸ Ñ€ÐµÐµÑÑ‚Ñ€Ð¾Ð¼
        2. **ÐÐ• Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€ÐµÐµÑÑ‚Ñ€ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð°**
        3. **Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¹ Ñ€ÐµÐµÑÑ‚Ñ€** Ñƒ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð°
        4. **Ð”Ð¾Ð¶Ð´Ð°Ñ‚ÑŒÑÑ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ**

        ### ðŸŽ¯ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸:
        ```sql
        SELECT p.processing_id, p.amount, p.commission_amount,
               (p.amount - p.commission_amount) as Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ°
        FROM processing_operations p
        WHERE p.status = 'success'
        AND p.created_date = '2025-01-15'
        ```
        """
    },
    "dba_requests": {
        "title": "ðŸ› ï¸ Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº DBA",
        "content": """
        ## ðŸ“ ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²:

        ### âœ… UPDATE Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹:
        ```sql
        UPDATE Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° SET Ð¿Ð¾Ð»Ðµ=Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ WHERE ÑƒÑÐ»Ð¾Ð²Ð¸Ðµ
        ```
        **ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
        ```sql
        UPDATE processing_operations 
        SET status='failed' 
        WHERE processing_id='PA023'
        ```

        ### âœ… INSERT Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹:
        ```sql
        INSERT INTO Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° (Ð¿Ð¾Ð»Ðµ1, Ð¿Ð¾Ð»Ðµ2) VALUES (Ð·Ð½Ð°Ñ‡1, Ð·Ð½Ð°Ñ‡2)
        ```
        **ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
        ```sql
        INSERT INTO processing_operations 
        (processing_id, status, amount) 
        VALUES ('PA999', 'success', 500.00)
        ```

        ## ðŸš« Ð—Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸:
        - `DROP`, `DELETE`, `TRUNCATE` - Ð½Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ÑÑ
        - Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð±ÐµÐ· `WHERE` ÑƒÑÐ»Ð¾Ð²Ð¸Ñ - Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÑÑŽÑ‚ÑÑ
        - Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€ÑÐºÐ¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… - Ð½Ðµ Ð´Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ

        ## ðŸ”’ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸:
        - Ð’ÑÐµÐ³Ð´Ð° Ð´ÐµÐ»Ð°Ð¹ Ð±ÑÐºÐ°Ð¿ Ð¿ÐµÑ€ÐµÐ´ Ð¼Ð°ÑÑÐ¾Ð²Ñ‹Ð¼Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸
        - Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
        - Ð¡Ð¾Ð³Ð»Ð°ÑÐ¾Ð²Ñ‹Ð²Ð°Ð¹ Ð¾Ð¿Ð°ÑÐ½Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ Ñ€ÑƒÐºÐ¾Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÐµÐ¼
        """
    },
    "data_quality": {
        "title": "ðŸ” ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…", 
        "content": """
        ## ðŸŽ¯ Ð¢Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…:

        ### 1. Ð Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð²
        **ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** Ð Ð°Ð·Ð½Ñ‹Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ Ñƒ Ð½Ð°Ñ Ð¸ Ñƒ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð°  
        **Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** ÐŸÑ€Ð¸Ð²ÐµÑÑ‚Ð¸ Ð½Ð°ÑˆÐ¸ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ñ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð¾Ð¼

        ### 2. ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ð¸
        **ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** ÐšÐ¾Ð¼Ð¸ÑÑÐ¸Ñ Ð² Ñ€ÐµÐµÑÑ‚Ñ€Ðµ Ð½Ðµ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ñ€Ð°ÑÑ‡ÐµÑ‚Ñƒ  
        **Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¹ Ñ€ÐµÐµÑÑ‚Ñ€ Ñƒ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð°

        ### 3. Ð”ÑƒÐ±Ð»Ð¸Ñ€ÑƒÑŽÑ‰Ð¸ÐµÑÑ Ñ€ÐµÐµÑÑ‚Ñ€Ñ‹
        **ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** ÐÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ñ€ÐµÐµÑÑ‚Ñ€Ð¾Ð² Ð½Ð° Ð¾Ð´Ð½Ñƒ Ð´Ð°Ñ‚Ñƒ  
        **Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð£Ñ‚Ð¾Ñ‡Ð½Ð¸Ñ‚ÑŒ Ñƒ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð° ÐºÐ°ÐºÐ¾Ð¹ Ñ€ÐµÐµÑÑ‚Ñ€ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚ÐµÐ½

        ### 4. ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ ÑÐ²ÑÐ·ÐµÐ¹
        **ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:** ÐÐµÑ‚ ÑÐ²ÑÐ·Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ Ð½Ð°ÑˆÐ¸Ð¼Ð¸ Ð¸ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€ÑÐºÐ¸Ð¼Ð¸ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑÐ¼Ð¸  
        **Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ operation_additional_data Ð½Ð° ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ÑÑ‚ÑŒ ÑÐ²ÑÐ·ÐµÐ¹

        ## ðŸ› ï¸ ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:

        ### Ð”Ð»Ñ ÐÐÐ¨Ð˜Ð¥ Ð´Ð°Ð½Ð½Ñ‹Ñ…:
        1. ÐÐ°Ð¹Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ Ñ‡ÐµÑ€ÐµÐ· SQL Ð·Ð°Ð¿Ñ€Ð¾Ñ
        2. Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð±ÑÐºÐ°Ð¿ Ð´Ð°Ð½Ð½Ñ‹Ñ…
        3. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ DBA Ð½Ð° Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ
        4. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚

        ### Ð”Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÐŸÐÐ Ð¢ÐÐ•Ð Ð:
        1. ÐÐ°Ð¹Ñ‚Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ðµ
        2. ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ€Ð°ÑÑ‡ÐµÑ‚Ñ‹ Ð¸ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð°
        3. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ñƒ Ñ‡ÐµÑ€ÐµÐ· ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ñ‡Ð°Ñ‚
        4. Ð”Ð¾Ð¶Ð´Ð°Ñ‚ÑŒÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ñ€ÐµÐµÑÑ‚Ñ€Ð°

        ## ðŸ“Š ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°:
        ```sql
        -- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°ÑÑ…Ð¾Ð¶Ð´ÐµÐ½Ð¸Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð²
        SELECT COUNT(*) as discrepancies
        FROM processing_operations p
        JOIN operation_additional_data o ON p.processing_id = o.processing_id
        JOIN partner_a_payments a ON o.additional_value = a.partner_id
        WHERE (p.status = 'success' AND a.status != 'COMPLETED')
           OR (p.status = 'failed' AND a.status != 'DECLINED')

        -- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´ÑƒÐ±Ð»ÐµÐ¹ Ñ€ÐµÐµÑÑ‚Ñ€Ð¾Ð²
        SELECT partner_contract_id, registry_date, COUNT(*) as registry_count
        FROM registry_statuses 
        WHERE is_excluded = 0
        GROUP BY partner_contract_id, registry_date
        HAVING COUNT(*) > 1
        ```
        """
    }
}
